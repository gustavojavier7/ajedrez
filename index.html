<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
    <!-- Meta tags adicionales para SEO y rendimiento -->
    <meta name="description" content="Analizador de ajedrez avanzado con motor Stockfish para partidas y an√°lisis.">
    <meta name="keywords" content="ajedrez, an√°lisis, stockfish, motor">
    <meta name="author" content="Chess Engine Team">
    
    <!-- Optimizaci√≥n de carga -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- Dependencias externas con sistema de respaldo -->
    <script>
        // Sistema de carga de Chess.js con m√∫ltiples CDNs
        const chessJsCDNs = [
            'https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js',
            'https://unpkg.com/chess.js@1.0.0/chess.min.js'
        ];
        
        let currentCDNIndex = 0;
        
        function loadChessJS() {
            return new Promise((resolve, reject) => {
                if (currentCDNIndex >= chessJsCDNs.length) {
                    reject(new Error('Todos los CDNs de Chess.js fallaron'));
                    return;
                }
                
                const script = document.createElement('script');
                script.src = chessJsCDNs[currentCDNIndex];
                script.crossOrigin = 'anonymous';
                
                script.onload = () => {
                    console.log(`‚úÖ Chess.js cargado desde CDN ${currentCDNIndex + 1}:`, chessJsCDNs[currentCDNIndex]);
                    resolve();
                };
                
                script.onerror = () => {
                    console.warn(`‚ö†Ô∏è CDN ${currentCDNIndex + 1} fall√≥:`, chessJsCDNs[currentCDNIndex]);
                    currentCDNIndex++;
                    document.head.removeChild(script);
                    loadChessJS().then(resolve).catch(reject);
                };
                
                document.head.appendChild(script);
            });
        }
        
        // Cargar Chess.js con sistema de respaldo
        loadChessJS().catch(error => {
            console.error('üí• No se pudo cargar Chess.js desde ning√∫n CDN:', error);
            document.addEventListener('DOMContentLoaded', () => {
                const chessboard = document.getElementById('chessboard');
                if (chessboard) {
                    chessboard.innerHTML = `
                        <div class="loading">
                            <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                            <p><strong>Error: Chess.js no disponible</strong></p>
                            <p style="font-size: 0.8rem; color: #6b7280;">
                                No se pudo cargar la librer√≠a de ajedrez desde ning√∫n CDN.
                            </p>
                            <button onclick="location.reload()" style="
                                padding: 10px 20px;
                                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 600;
                                margin-top: 10px;
                            ">üîÑ Reintentar</button>
                        </div>
                    `;
                }
            });
        });
    </script>
    
    <!-- Estilos locales -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon y PWA -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ôõ</text></svg>">
</head>
<body>
    <!-- Indicador de carga inicial -->
    <div id="initialLoader" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        color: white;
        flex-direction: column;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    ">
        <div style="text-align: center;">
            <i class="fas fa-chess-queen" style="font-size: 4rem; margin-bottom: 1rem; animation: pulse 2s infinite;"></i>
            <h2 style="margin-bottom: 0.5rem;">Motor de Ajedrez v2.0</h2>
            <p style="opacity: 0.8;">Cargando sistema...</p>
        </div>
    </div>

    <div class="container">
        <!-- ENCABEZADO -->
        <div class="header">
        </div>

        <!-- SECCI√ìN DE ENTRADA -->
        <div class="input-section">
            <div class="input-row">
                <div class="input-group">
                    <label for="fenInput">
                        <i class="fas fa-code"></i> Posici√≥n FEN:
                    </label>
                    <input type="text"
                           id="fenInput"
                           value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1" 
                           placeholder="Ingresa la posici√≥n FEN o usa las posiciones predefinidas" 
                           onclick="this.select()"
                           title="Notaci√≥n Forsyth-Edwards para describir posiciones de ajedrez">
                </div>
                <div class="input-group">
                    <label for="modeSelect">
                        <i class="fas fa-gamepad"></i> Modo:
                    </label>
                    <select id="modeSelect">
                        <option value="edit">Edici√≥n</option>
                        <option value="human">Humano vs Humano</option>
                        <option value="cpu">Versus CPU</option>
                    </select>
                </div>
                <div class="button-group">
                    <div class="primary-buttons" style="display: flex; gap: 10px;">
                        <button onclick="window.chessApp.drawBoard()" class="btn btn-primary" title="Cargar y analizar la posici√≥n FEN">
                            <i class="fas fa-chess-board"></i>Cargar Posici√≥n
                        </button>
                        <button onclick="window.chessApp.showLegalMoves()" id="showMovesBtn" class="btn btn-success" title="Mostrar todos los movimientos legales">
                            <i class="fas fa-list"></i>Movimientos
                        </button>
                    </div>
                    <div class="preset-positions">
                        <button onclick="loadPresetPosition('opening')" class="btn btn-preset" title="Gambito de Dama">
                            <i class="fas fa-play"></i>Apertura
                        </button>
                        <button onclick="loadPresetPosition('middlegame')" class="btn btn-preset" title="Posici√≥n de medio juego compleja">
                            <i class="fas fa-chess"></i>Medio Juego
                        </button>
                        <button onclick="loadPresetPosition('endgame')" class="btn btn-preset" title="Final de torre y peones">
                            <i class="fas fa-flag-checkered"></i>Final
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LAYOUT PRINCIPAL -->
        <div class="main-layout">
            <!-- TABLERO Y ESTADO -->
            <div class="board-container-wrapper">
                <div class="board-section">
                    <div id="chessboard">
                        <div class="loading">
                            <i class="fas fa-chess-board"></i>
                            <p>Inicializando motor de ajedrez...</p>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="gameStatus" class="game-status-compact">
                    <i class="fas fa-info-circle"></i>
                    <span>Inicializando sistema...</span>
                </div>
                
                <!-- Indicadores de rendimiento -->
                <div class="performance-indicators">
                    <div class="indicator" id="depthIndicator">
                        <span class="indicator-label">Profundidad Adaptativa</span>
                        <span class="indicator-value" id="depthValue">--</span>
                    </div>
                    <div class="indicator" id="timeIndicator">
                        <span class="indicator-label">Tiempo Previsto</span>
                        <span class="indicator-value" id="timeValue">--</span>
                    </div>
                </div>
            </div>

            <!-- PANEL DERECHO DE AN√ÅLISIS -->
            <div class="right-panel">
                <div class="analysis-panel">
                    <div class="analysis-grid">
                        <!-- MOTOR DE AN√ÅLISIS Y EVALUACI√ìN -->
                        <div class="analysis-section motor-eval-section">
                            <div class="section-title">
                                <i class="fas fa-microchip"></i>
                                Motor Stockfish
                                <div class="status-indicator" id="engineStatusIndicator"></div>
                            </div>
                            <div class="engine-controls">
                                <button onclick="window.chessApp.toggleEngine()" 
                                        id="engineToggleBtn" 
                                        class="btn btn-purple"
                                        title="Conectar/Desconectar motor Stockfish">
                                    <i class="fas fa-plug"></i>Conectar Motor
                                </button>
                                <button onclick="window.chessApp.toggleAnalysis()"
                                        id="analysisToggleBtn"
                                        class="btn btn-success"
                                        title="Iniciar/Detener an√°lisis">
                                    <i class="fas fa-play"></i>Analizar
                                </button>
                                <button onclick="window.chessApp.forceBestMove()"
                                        id="forceMoveBtn"
                                        class="btn btn-warning"
                                        title="Forzar el movimiento de la mejor l√≠nea">
                                    <i class="fas fa-forward"></i>Forzar movimiento
                                </button>
                                <label style="display:flex;align-items:center;margin-left:8px;gap:4px;">
                                    <input type="checkbox" id="adaptiveToggle" checked>
                                    <span style="font-size:0.9rem;">Modo adaptativo</span>
                                </label>
                            </div>
                            <div id="engineStatus" class="engine-status">Motor no conectado</div>
                            <div class="section-title">
                                <i class="fas fa-balance-scale"></i>
                                Evaluaci√≥n
                            </div>
                            <div class="evaluation-display">
                                <span id="evaluation" class="evaluation">--</span>
                                <span id="bestMove" class="best-move">--</span>
                            </div>
                            <div class="stats-display">
                                <span id="engineStats" title="Profundidad de b√∫squeda y velocidad">--</span>
                                <span id="memoryStats" title="Uso de memoria JavaScript">--</span>
                                <span id="analysisTimer" title="Tiempo de an√°lisis">--</span>
                            </div>
                        </div>


                        <!-- VARIANTE PRINCIPAL -->
                        <div class="analysis-section pv-section-wrapper">
                            <div class="pv-section">
                                <div class="pv-title">
                                    <i class="fas fa-route"></i>
                                    Mejor l√≠nea de juego:
                                    <button class="copy-pv-btn" onclick="copyPVToClipboard()" title="Copiar variante principal">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div id="pvLine" class="pv-line">
                                    Inicia el an√°lisis para ver la mejor l√≠nea calculada por el motor
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PANEL DE MOVIMIENTOS LEGALES -->
                <div id="legalMoves" class="moves-panel" style="display: none;">
                    <div class="moves-header">
                        <h3 id="legalMovesHeader">
                            <i class="fas fa-chess-knight"></i>
                            Movimientos Legales
                        </h3>
                        <button onclick="window.chessApp.hideLegalMoves()" class="close-btn" title="Cerrar panel">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="legalMovesList" class="moves-list"></div>
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script>
        function loadPresetPosition(type) {
            const positions = {
                'opening': "rnbqkbnr/ppp1pppp/8/3p4/2PP4/8/PP2PPPP/RNBQKBNR b KQkq c3 0 2",
                'middlegame': "r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/3P1N2/PPP2PPP/RNBQK2R w KQkq - 4 4",
                'endgame': "8/8/8/8/8/8/4K3/4k3 w - - 0 1"
            };
            document.getElementById('fenInput').value = positions[type];
            if (window.chessApp) window.chessApp.drawBoard();
        }
        
        
        function copyPVToClipboard() {
            const pvText = document.getElementById('pvLine').textContent;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(pvText).then(() => {
                    console.log('‚úÖ Variante principal copiada al portapapeles');
                });
            }
        }
        
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('initialLoader');
                if (loader) {
                    loader.style.opacity = '0';
                    loader.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => loader.remove(), 500);
                }
            }, 1000);
        });
        
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
    
    <script src="script.js"></script>
</body>
</html>
